var colorRampPresets = `<colorRampCollection>
	<colorRamp name="Campfire" tags="OIC,aesthetic">0x660000,0xFF0000,0xFFFF00</colorRamp>
	<colorRamp name="Pink Rose" tags="OIC,aesthetic">0xffc7fa,0xfa0094,0x660066</colorRamp>
	<colorRamp name="Linear Gray" tags="OIC,visualization,colorblind-safe,single-hue">0x000000,0xffffff</colorRamp>
	<colorRamp name="Blue Green Red" tags="OIC,visualization">0x0000ff,0x00ff00,0xff0000</colorRamp>
	<colorRamp name="Red Scale" tags="OIC,visualization,single-hue">0x000000,0xff0000,0xffcccc</colorRamp>
	<colorRamp name="Blue To Cyan" tags="OIC,visualization">0x000000,0x00b7f6,0x0bc4ff,0x68ffff,0xffffff</colorRamp>
	<colorRamp name="Blue To Yellow" tags="OIC,visualization">0x0000ff,0xffff00</colorRamp>
	<colorRamp name="Heated" tags="OIC,visualization,single-hue">0x130000,0x611501,0xb26b01,0xf0902e,0xfbbc06,0xfefefe</colorRamp>
	<colorRamp name="MCH - Brown" tags="OIC,visualization,single-hue">0x611501,0xb26b01,0xf0902e,0xfbbc06</colorRamp>
	<colorRamp name="Jet" tags="OIC,visualization,qualitative">0x000086,0x0000ff,0x00ffff,0xffff00,0xff0000,0x860000</colorRamp>
	<colorRamp name="Linearized Optimal" tags="OIC,visualization">0x000000,0x870000,0x87fe00,0x87ffff,0xffffff</colorRamp>
	<colorRamp name="Rainbow" tags="OIC,visualization">0x000000,0x470057,0x17458f,0x5fc046,0xa0c84c,0xffb38e,0xffffff</colorRamp>
	<colorRamp name="Traffic Light" tags="OIC,basic">0x00FF00,0xFFFF00,0xFF0000</colorRamp>
	<colorRamp name="Arizona Skyline" tags="OIC,aesthetic">0x5683B9,0xFFF0A1,0xE0991B,0xC23600,0x503000</colorRamp>
	<colorRamp name="Watermelon" tags="OIC,aesthetic">0x3E5B13,0x61B10D,0xCCCD06,0xFF8F88,0x630000</colorRamp>
	<colorRamp name="Thunderstorm" tags="OIC,aesthetic">0x585634,0x4781B5,0x6FBAFF,0xffff00</colorRamp>
	<colorRamp name="Old Leather" tags="OIC,aesthetic">0x404320,0x71550E,0x896731,0xDDD200,0x5C97BA,0x5C97BA</colorRamp>
	<colorRamp name="Autumn" tags="OIC,aesthetic">0x1A0000,0x712B00,0xFFBF88,0xFF6B00,0xFA0000</colorRamp>
	<colorRamp name="Eggplant" tags="OIC,aesthetic">0x040009,0x4E0075,0x7E00A5,0xE2A510,0xFFFF99</colorRamp>
	<colorRamp name="Antique Flag" tags="OIC,aesthetic">0x114B48,0x00AFF7,0xDBF9EF,0xABB869,0xFF0000</colorRamp>
	<colorRamp name="Agate" tags="OIC,aesthetic">0x6E4D58,0x9199A6,0xFFDCB7,0xFE7A1D,0xCB0000</colorRamp>
	<colorRamp name="Bee" tags="OIC,aesthetic,single-hue">0x000000,0xFFFF00</colorRamp>
	<colorRamp name="Ornamental Cabbage" tags="OIC,aesthetic">0x3E2A64,0x61B812,0xC4C74B,0xCCC59B,0xB4377A,0xB4377A</colorRamp>
	<colorRamp name="Neon" tags="OIC,aesthetic">0x334833,0xD75B8F,0xFF0080,0xFFFF00,0x00D100</colorRamp>
	<colorRamp name="High Desert" tags="OIC,aesthetic">0xB47046,0x72616A,0xD1C7C8,0xFFFFFF,0x0028AE</colorRamp>
	<colorRamp name="Vermilion Cliffs" tags="OIC,aesthetic">0x641300,0xD32500,0xFF7500,0xFFCA7D,0x0000D2,0x0000D2</colorRamp>
	<colorRamp name="Papaya" tags="OIC,aesthetic">0x101C01,0x3F8751,0x386C00,0xFD9E00,0xEF0000</colorRamp>
	<colorRamp name="Van Gogh" tags="OIC,aesthetic">0x31415A,0x609DCD,0xFFFF00,0xE9B400,0xBE2E00</colorRamp>
	<colorRamp name="Outer Banks" tags="OIC,aesthetic">0x674F38,0xD62A00,0xF7AD00,0xFAEABB,0x0096C4</colorRamp>
	<colorRamp name="Desert Sands" tags="OIC,aesthetic">0xF8E368,0xCEBA00,0x816B00,0xB55800,0x542000,0x242000</colorRamp>
	<colorRamp name="Moonlight" tags="OIC,aesthetic">0x040505,0x363635,0x0A0528,0xD1F0E4,0xDCC400,0xDCC400</colorRamp>
	<colorRamp name="Twilight" tags="OIC,aesthetic">0x2F2521,0xC8ACFE,0xFFFFFF,0xE4FF00</colorRamp>
	<colorRamp name="Rosebud" tags="OIC,aesthetic">0x69594E,0xADAF48,0xFEF0FE,0xF3008B,0xCD001E</colorRamp>
	<colorRamp name="Morning Glory" tags="OIC,aesthetic">0x590653,0xFFC1FF,0xFFFF00,0x5D00FF,0x3C00D9</colorRamp>
	<colorRamp name="Cloudy Night" tags="OIC,aesthetic">0x070411,0x6733AE,0xFFFFFF,0xFF6E00</colorRamp>
	<colorRamp name="Vintage Map" tags="OIC,aesthetic">0xFAF9E6,0xFBF672,0xFFD99F,0xB4C352,0x92E5CA,0xFD9DAB</colorRamp>
	<colorRamp name="Doppler Radar" tags="OIC,aesthetic,qualitative">0x04E9E7,0x009DF4,0x0201F4,0x01FC01,0x00C400,0x008C00,0x0FDF801,0xF99200,0xFD0000,0xBC0000,0xF800FD,0x9854C6</colorRamp>

	<colorRamp name="Bu Gn" tags="ColorBrewer,basic,sequential,colorblind-safe">0xEDF8FB,0xB2E2E2,0x66C2A4,0x2CA25F,0x006D2C</colorRamp>
	<colorRamp name="Bu Pu" tags="ColorBrewer,basic,sequential,colorblind-safe">0xEDF8FB,0xB3CDE3,0x8C96C6,0x8856A7,0x810F7C</colorRamp>
	<colorRamp name="Gn Bu" tags="ColorBrewer,basic,sequential,printer-friendly,colorblind-safe">0xF0F9E8,0xBAE4BC,0x7BCCC4,0x43A2CA,0x0868AC</colorRamp>
	<colorRamp name="Or Rd" tags="ColorBrewer,basic,sequential,colorblind-safe">0xFEF0D9,0xFDCC8A,0xFC8D59,0xE34A33,0xB30000</colorRamp>
	<colorRamp name="Pu Bu" tags="ColorBrewer,basic,sequential,colorblind-safe">0xF1EEF6,0xBDC9E1,0x74A9CF,0x2B8CBE,0x045A8D</colorRamp>
	<colorRamp name="Pu Bu Gn" tags="ColorBrewer,basic,sequential,colorblind-safe">0xF6EFF7,0xBDC9E1,0x67A9CF,0x1C9099,0x016C59</colorRamp>
	<colorRamp name="Pu Rd" tags="ColorBrewer,basic,sequential,printer-friendly,colorblind-safe">0xF1EEF6,0xD7B5D8,0xDF65B0,0xDD1C77,0x980043</colorRamp>
	<colorRamp name="Rd Pu" tags="ColorBrewer,basic,sequential,printer-friendly,colorblind-safe">0xFEEBE2,0xFBB4B9,0xF768A1,0xC51B8A,0x7A0177</colorRamp>
	<colorRamp name="Yl Gn" tags="ColorBrewer,basic,sequential,colorblind-safe">0xFFFFCC,0xC2E699,0x78C679,0x31A354,0x006837</colorRamp>
	<colorRamp name="Yl Gn Bu" tags="ColorBrewer,basic,sequential,printer-friendly,colorblind-safe">0xFFFFCC,0xA1DAB4,0x41B6C4,0x2C7FB8,0x253494</colorRamp>
	<colorRamp name="Yl Or Br" tags="ColorBrewer,basic,sequential,colorblind-safe">0xFFFFD4,0xFED98E,0xFE9929,0xD95F0E,0x993404</colorRamp>
	<colorRamp name="Yl Or Rd" tags="ColorBrewer,basic,sequential,colorblind-safe">0xFFFFB2,0xFECC5C,0xFD8D3C,0xF03B20,0xBD0026</colorRamp>
	<colorRamp name="Blues" tags="ColorBrewer,basic,sequential,single-hue,colorblind-safe">0xEFF3FF,0xBDD7E7,0x6BAED6,0x3182BD,0x08519C</colorRamp>
	<colorRamp name="Greens" tags="ColorBrewer,basic,sequential,single-hue,colorblind-safe">0xEDF8E9,0xBAE4B3,0x74C476,0x31A354,0x006D2C</colorRamp>
	<colorRamp name="Greys" tags="ColorBrewer,basic,sequential,single-hue,colorblind-safe">0xF7F7F7,0xCCCCCC,0x969696,0x636363,0x252525</colorRamp>
	<colorRamp name="Oranges" tags="ColorBrewer,basic,sequential,single-hue,colorblind-safe">0xFEEDDE,0xFDBE85,0xFD8D3C,0xE6550D,0xA63603</colorRamp>
	<colorRamp name="Purples" tags="ColorBrewer,basic,sequential,single-hue,colorblind-safe">0xF2F0F7,0xCBC9E2,0x9E9AC8,0x756BB1,0x54278F</colorRamp>
	<colorRamp name="Reds" tags="ColorBrewer,basic,sequential,single-hue,colorblind-safe">0xFEE5D9,0xFCAE91,0xFB6A4A,0xDE2D26,0xA50F15</colorRamp>
	<colorRamp name="Br BG" tags="ColorBrewer,basic,diverging,colorblind-safe,printer-friendly">0xA6611A,0xDFC27D,0xF5F5F5,0x80CDC1,0x018571</colorRamp>
	<colorRamp name="Pi YG" tags="ColorBrewer,basic,diverging,colorblind-safe">0xD01C8B,0xF1B6DA,0xF7F7F7,0xB8E186,0x4DAC26</colorRamp>
	<colorRamp name="PR Gn" tags="ColorBrewer,basic,diverging,colorblind-safe,printer-friendly">0x7B3294,0xC2A5CF,0xF7F7F7,0xA6DBA0,0x008837</colorRamp>
	<colorRamp name="Pu Or" tags="ColorBrewer,basic,diverging,colorblind-safe">0xE66101,0xFDB863,0xF7F7F7,0xB2ABD2,0x5E3C99</colorRamp>
	<colorRamp name="Rd Bu" tags="ColorBrewer,basic,diverging,colorblind-safe,printer-friendly">0xCA0020,0xF4A582,0xF7F7F7,0x92C5DE,0x0571B0</colorRamp>
	<colorRamp name="Rd Gy" tags="ColorBrewer,basic,diverging,printer-friendly">0xCA0020,0xF4A582,0xFFFFFF,0xBABABA,0x404040</colorRamp>
	<colorRamp name="Rd Yl Bu" tags="ColorBrewer,basic,diverging,colorblind-safe,printer-friendly">0xD7191C,0xFDAE61,0xFFFFBF,0xABD9E9,0x2C7BB6</colorRamp>
	<colorRamp name="Rd Yl Gn" tags="ColorBrewer,basic,diverging,printer-friendly">0xD7191C,0xFDAE61,0xFFFFBF,0xA6D96A,0x1A9641</colorRamp>
	<colorRamp name="Spectral" tags="ColorBrewer,basic,diverging,printer-friendly,photocopy-friendly">0xD7191C,0xFDAE61,0xFFFFBF,0xABDDA4,0x2B83BA</colorRamp>
	<colorRamp name="Accent" tags="ColorBrewer,basic,qualitative">0x7FC97F,0xBEAED4,0xFDC086,0xFFFF99,0x386CB0,0xF0027F,0xBF5B17,0x666666</colorRamp>
	<colorRamp name="Dark2" tags="ColorBrewer,basic,qualitative,printer-friendly">0x1B9E77,0xD95F02,0x7570B3,0xE7298A,0x66A61E,0xE6AB02,0xA6761D,0x666666</colorRamp>
	<colorRamp name="Paired" tags="ColorBrewer,basic,qualitative">0xA6CEE3,0x1F78B4,0xB2DF8A,0x33A02C,0xFB9A99,0xE31A1C,0xFDBF6F,0xFF7F00</colorRamp>
	<colorRamp name="Pastel 1" tags="ColorBrewer,basic,qualitative">0xFBB4AE,0xB3CDE3,0xCCEBC5,0xDECBE4,0xFED9A6,0xFFFFCC,0xE5D8BD,0xFDDAEC</colorRamp>
	<colorRamp name="Pastel 2" tags="ColorBrewer,basic,qualitative">0xB3E2CD,0xFDCDAC,0xCBD5E8,0xF4CAE4,0xE6F5C9,0xFFF2AE,0xF1E2CC,0xCCCCCC</colorRamp>
	<colorRamp name="Set 1" tags="ColorBrewer,basic,qualitative,printer-friendly">0xE41A1C,0x377EB8,0x4DAF4A,0x984EA3,0xFF7F00,0xFFFF33,0xA65628,0xF781BF</colorRamp>
	<colorRamp name="Set 2" tags="ColorBrewer,basic,qualitative">0x66C2A5,0xFC8D62,0x8DA0CB,0xE78AC3,0xA6D854,0xFFD92F,0xE5C494,0xB3B3B3</colorRamp>
	<colorRamp name="Set 3" tags="ColorBrewer,basic,qualitative,printer-friendly">0x8DD3C7,0xFFFFB3,0xBEBADA,0xFB8072,0x80B1D3,0xFDB462,0xB3DE69,0xFCCDE5</colorRamp>
</colorRampCollection>`;





(function () {


    // internal Class
    (function () {

        function ColorNode(position, color) {
            this.position = position;
            this.color = color;
        }

        ColorRamp.ColorNode = ColorNode;

    }());

    /**
     * temporary solution to save the namespace for this class/prototype
     * @static
     * @public
     * @property NS
     * @default weavecore
     * @readOnly
     * @type String
     */
    Object.defineProperty(ColorRamp, 'NS', {
        value: 'weavedata'
    });

    /**
     * TO-DO:temporary solution to save the CLASS_NAME constructor.name works for window object , but modular based won't work
     * @static
     * @public
     * @property CLASS_NAME
     * @readOnly
     * @type String
     */
    Object.defineProperty(ColorRamp, 'CLASS_NAME', {
        value: 'ColorRamp'
    });

    Object.defineProperties(ColorRamp, {
        'COLOR': {
            value: 'color'
        },
        'POSITION': {
            value: 'position'
        }
    });



    /*
    [Embed(source = "/weave/resources/ColorRampPresets.xml", mimeType = "application/octet-stream")]
        private static
        const ColorRampPresetsXML: Class;
        private static
        var _allColorRamps: XML = null;
        public static

        function get allColorRamps(): XML {
            if (_allColorRamps == null) {
                var ba: ByteArray = (new ColorRampPresetsXML()) as ByteArray;
                _allColorRamps = new XML(ba.readUTFBytes(ba.length));
                _allColorRamps.ignoreWhitespace = true;
            }
            return _allColorRamps;
        }
        public static

        function getColorRampXMLByName(rampName: String): XML {
            try {
                return (allColorRamps.colorRamp.(@name == rampName)[0] as XML).copy();
            } catch (e: Error) {}
            return null;
        }
        public static

        function findMatchingColorRampXML(ramp: ColorRamp): XML {
            var colors: Array = ramp.getColors();
            for (var i: int = 0; i < colors.length; i++)
                colors[i] = '0x' + StandardLib.numberToBase(colors[i], 16, 6);
            var str: String = colors.join(',').toUpperCase();
            for each(var xml: XML in allColorRamps.colorRamp) {
                var text: String = xml.toString().toUpperCase();
                if (text == str)
                    return xml;
            }
            return null;
        }*/



    /**
     *
     * @author adufilie
     * @author sanjay1909
     */
    function ColorRamp(sessionState) {
        sessionState = sessionState === undefined ? null : sessionState;
        // weavecore.LinkableVariable.call(this, null, verifyState.bind(this), sessionState || ColorRamp.getColorRampXMLByName("Blues").toString());
        weavecore.LinkableVariable.call(this, null, null, sessionState);


        this._validateTriggerCount = 0;





        /**
         * An array of ColorNode objects, each having "color" and "position" properties, sorted by position.
         * This Array should be kept private.
         */
        this._colorNodes = [];

    }



    /*function verifyState(state: Object): Boolean {
        if (state is XML)
            state = (state as XML).toXMLString();

        if (state is String) {
            var reversed: Boolean = false;

            // see if we should try parsing as xml
            if ((state as String).charAt(0) == '<' && (state as String).substr(-1) == '>') {
                try {
                    var xml: XML = XML(state);
                    var text: String = xml.text();
                    reversed = String(xml.@reverse) == 'true';
                    if (text) {
                        state = text;
                    } else {
                        // handle a list of colorNode tags containing position and color attributes
                        var objects: Array = [];
                        var nodes: XMLList = xml.children();
                        var n: int = nodes.length();
                        for each(var node: XML in nodes) {
                            var position: String = node.@[POSITION];
                            var pos: Number = position == '' ? objects.length / (n - 1) : Number(position);
                            var color: Number = Number(node.@[COLOR]);
                            objects.push({
                                "color": color,
                                "position": pos
                            });
                        }
                        if (reversed)
                            objects.reverse();
                        this.setSessionState(objects);
                        return false;
                    }
                } catch (e: Error) {} // not an XML
            }

            // parse list of color values
            var colors: Array = WeaveAPI.CSVParser.parseCSVRow(text || state as String);
            if (reversed)
                colors.reverse();
            this.setSessionState(colors);
            return false;
        }

        var type: Class = StandardLib.getArrayType(state as Array);
        if (type == Number) {
            var array: Array = [];
            for each(var number: Number in state)
            array.push('0x' + StandardLib.numberToBase(number, 16, 6).toUpperCase());
            this.setSessionState(array);
            return false;
        }
        return type == String || type == Object;
    }*/




    function validate() {
        if (this._validateTriggerCount == this.triggerCounter)
            return;

        this._validateTriggerCount = this.triggerCounter;

        this._colorNodes = [];
        this.getSessionState().forEach(function (item) {
            if (typeof item == 'object')
                this._colorNodes.push(new ColorRamp.ColorNode(item[POSITION], item[COLOR]));
            else
                this._colorNodes.push(new ColorRamp.ColorNode(this._colorNodes.length, weavecore.StandardLib.asNumber(item)));
        });

        // if min,max positions are not 0,1, normalize all positions between 0 and 1
        var positions = weavedata.VectorUtils.pluck(this._colorNodes, POSITION);
        var minPos = Math.min.apply(null, positions);
        var maxPos = Math.max.apply(null, positions);
        this._colorNodes.forEach(function (node) {
            node.position = weavecore.StandardLib.normalize(node.position, minPos, maxPos);
        });

        this._colorNodes.sortOn("position");
    }



    ColorRamp.prototype = new weavecore.LinkableVariable();
    ColorRamp.prototype.constructor = ColorRamp;

    var p = ColorRamp.prototype;


    /**
     * @param normValue A value between 0 and 1.
     * @return A color.
     */
    p.getColorFromNorm = function (normValue) {
        validate.call(this);

        if (isNaN(normValue) || normValue < 0 || normValue > 1 || this._colorNodes.length == 0)
            return NaN;

        // find index to the right of normValue
        var rightIndex = 0;
        while (rightIndex < this._colorNodes.length && normValue >= (this._colorNodes[rightIndex]).position)
            rightIndex++;
        var leftIndex = Math.max(0, rightIndex - 1);
        var leftNode = this._colorNodes[leftIndex];
        var rightNode = this._colorNodes[rightIndex];

        // handle boundary conditions
        if (rightIndex == 0)
            return rightNode.color;
        if (rightIndex == _colorNodes.length)
            return leftNode.color;

        var interpolationValue = (normValue - leftNode.position) / (rightNode.position - leftNode.position);
        return weavecore.StandardLib.interpolateColor(interpolationValue, leftNode.color, rightNode.color);
    }


    /*public

    function getColors(): Array {
        validate();

        var colors: Array = [];

        for (var i: int = 0; i < _colorNodes.length; i++)
            colors.push((_colorNodes[i] as ColorNode).color);

        return colors;
    }


    public

    function reverse(): void {
        var array: Array = this.getSessionState() as Array;
        if (array)
            this.setSessionState(array.reverse());
    }*/

    if (typeof exports !== 'undefined') {
        module.exports = ColorRamp;
    } else {

        window.weavedata = window.weavedata ? window.weavedata : {};
        window.weavedata.ColorRamp = ColorRamp;
    }

    weavecore.ClassUtils.registerClass('weavedata.ColorRamp', weavedata.ColorRamp);

}());
